<!DOCTYPE html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø­Ù…ÙŠØ¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© | Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a',
                        },
                        dark: {
                            bg: '#0f172a', card: '#1e293b', text: '#f1f5f9'
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„ÙƒÙ† Ù…Ø¹ Ø¨Ù‚Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙØ© */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .dark .glass {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Checkbox Animation */
        .checkbox-wrapper input:checked + div {
            background-color: #10b981; border-color: #10b981;
        }
        .checkbox-wrapper input:checked + div svg { stroke-dashoffset: 0; }
        
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 dark:bg-dark-bg dark:text-gray-100 transition-colors duration-300 h-[100dvh] flex flex-col overflow-hidden selection:bg-brand-500 selection:text-white">

    <canvas id="confetti-canvas"></canvas>

    <div id="toast-container" class="fixed top-4 left-1/2 -translate-x-1/2 z-[110] space-y-2 w-[90%] max-w-sm pointer-events-none"></div>

    <div id="loginScreen" class="fixed inset-0 z-[60] flex flex-col items-center justify-center transition-all duration-700">
        <div class="absolute inset-0 overflow-hidden bg-slate-900">
            <div class="absolute top-0 -left-4 w-72 h-72 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
            <div class="absolute top-0 -right-4 w-72 h-72 bg-yellow-500 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
            <div class="absolute -bottom-8 left-20 w-72 h-72 bg-pink-500 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
        </div>

        <div class="relative glass p-8 rounded-3xl shadow-2xl w-[90%] max-w-sm text-center transform transition-all hover:scale-[1.01]">
            <div class="w-20 h-20 bg-gradient-to-br from-brand-500 to-cyan-400 rounded-2xl rotate-3 mx-auto mb-6 flex items-center justify-center shadow-lg shadow-brand-500/30">
                <span class="text-4xl -rotate-3">ğŸ“</span>
            </div>
            <h1 class="text-3xl font-black mb-2 dark:text-white">Ù…Ù†ØµØ© Ø­Ù…ÙŠØ¯</h1>
            <p class="text-slate-500 dark:text-slate-400 text-sm mb-8 font-medium">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„ØªÙÙˆÙ‚</p>
            
            <div class="space-y-4">
                <div class="relative group">
                    <input type="password" id="passwordInput" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ (123)" 
                        class="w-full p-4 pl-12 bg-white/50 dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700 focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition text-center text-lg dir-ltr placeholder:text-slate-400">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-brand-500 transition">ğŸ”</span>
                </div>
                
                <button onclick="checkLogin()" 
                    class="w-full bg-gradient-to-r from-brand-600 to-cyan-600 hover:from-brand-700 hover:to-cyan-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-brand-500/25 transition transform active:scale-[0.98] flex items-center justify-center gap-2">
                    <span>Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†ØµØ©</span>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                </button>
            </div>
        </div>
        <p class="relative text-white/20 text-[10px] mt-8 tracking-widest uppercase">Version 4.0 Pro</p>
    </div>

    <div id="appScreen" class="hidden h-full flex flex-col relative w-full max-w-2xl mx-auto bg-white dark:bg-dark-bg shadow-2xl overflow-hidden transition-colors duration-300">
        
        <header class="relative bg-white dark:bg-dark-card pt-6 pb-4 px-5 z-20 shrink-0 border-b border-slate-100 dark:border-slate-800">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-brand-100 dark:bg-brand-900/30 rounded-full flex items-center justify-center text-xl">ğŸ‘‹</div>
                    <div>
                        <h1 class="text-xl font-black dark:text-white" id="greetingMsg">Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡</h1>
                        <p class="text-xs text-slate-500 dark:text-slate-400 font-bold" id="dateDisplay">--/--/----</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="toggleDarkMode()" class="w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-yellow-400 flex items-center justify-center transition border border-slate-200 dark:border-slate-700 active:scale-90">
                        <svg id="moonIcon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg id="sunIcon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                    <button onclick="logout()" class="w-10 h-10 rounded-full bg-red-50 dark:bg-red-900/20 text-red-500 flex items-center justify-center transition border border-red-100 dark:border-red-900/30 active:scale-90">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    </button>
                </div>
            </div>

            <div class="bg-gradient-to-r from-brand-600 to-blue-500 rounded-2xl p-4 text-white shadow-lg shadow-brand-500/20 relative overflow-hidden">
                <div class="absolute right-0 top-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10 pointer-events-none"></div>
                <div class="flex justify-between items-end relative z-10">
                    <div>
                        <p class="text-brand-100 text-xs font-medium mb-1">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¹Ø§Ù…</p>
                        <h2 class="text-4xl font-black tracking-tight" id="percentage">0%</h2>
                    </div>
                    <div class="text-left">
                        <div class="bg-white/20 backdrop-blur-sm px-3 py-1 rounded-lg text-xs font-bold mb-1 border border-white/10" id="statusBadge">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</div>
                        <p class="text-brand-100 text-[10px]">
                            <span id="statsCount" class="font-bold text-white text-base">0</span> / <span id="statsTotal">0</span> Ù…Ø­Ø§Ø¶Ø±Ø©
                        </p>
                    </div>
                </div>
                <div class="mt-4 h-2 bg-black/20 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full bg-white/90 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
                </div>
            </div>

            <div class="mt-4 relative">
                <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­Ø§Ø¶Ø±Ø©..." onkeyup="filterLectures()"
                    class="w-full bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-white pl-10 pr-4 py-3 rounded-xl border-none focus:ring-2 focus:ring-brand-500 transition placeholder:text-slate-400 text-sm">
                <svg class="w-5 h-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto px-4 py-6 space-y-6 scroll-smooth no-scrollbar" id="teachersContainer">
            
            <div id="resumeContainer" class="hidden animate-float">
                <button onclick="resumeLastWatched()" class="w-full bg-slate-900 dark:bg-white text-white dark:text-slate-900 p-4 rounded-2xl flex items-center justify-between shadow-xl group relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-r from-violet-600/20 to-fuchsia-600/20 opacity-0 group-hover:opacity-100 transition"></div>
                    <div class="flex items-center gap-3 z-10">
                        <div class="w-10 h-10 rounded-full bg-white/20 dark:bg-slate-900/10 flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </div>
                        <div class="text-right">
                            <span class="block text-[10px] opacity-70 font-medium">Ø¢Ø®Ø± Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                            <span class="block text-sm font-bold truncate max-w-[180px]" id="resumeTitle">...</span>
                        </div>
                    </div>
                    <div class="text-[10px] font-bold border border-current px-2 py-1 rounded-lg z-10">Ø§Ø³ØªÙ…Ø±Ø§Ø±</div>
                </button>
            </div>

            <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-100 dark:border-amber-800/30 rounded-2xl p-4 flex items-start gap-3">
                <span class="text-2xl mt-1">ğŸ“–</span>
                <div>
                    <h3 class="text-amber-800 dark:text-amber-400 font-bold text-sm mb-1">Ø¯Ø§ÙØ¹ Ù‚Ø±Ø¢Ù†ÙŠ</h3>
                    <p class="text-amber-700 dark:text-amber-200/80 text-xs leading-relaxed font-medium">"ÙˆÙØ£ÙÙ† Ù„ÙÙ‘ÙŠÙ’Ø³Ù Ù„ÙÙ„Ù’Ø¥ÙÙ†Ø³ÙØ§Ù†Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù…ÙØ§ Ø³ÙØ¹ÙÙ‰Ù° * ÙˆÙØ£ÙÙ†ÙÙ‘ Ø³ÙØ¹Ù’ÙŠÙÙ‡Ù Ø³ÙÙˆÙ’ÙÙ ÙŠÙØ±ÙÙ‰Ù°"</p>
                </div>
            </div>

            <div id="loader" class="space-y-4 animate-pulse">
                <div class="h-32 bg-slate-200 dark:bg-slate-800 rounded-3xl"></div>
                <div class="h-32 bg-slate-200 dark:bg-slate-800 rounded-3xl"></div>
            </div>

        </main>
    </div>

    <div id="videoModal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 hidden opacity-0 transition-all duration-300 backdrop-blur-md bg-black/80" onclick="closeVideoModal()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-4xl shadow-2xl overflow-hidden transform scale-95 transition-all duration-300 flex flex-col border border-white/10" onclick="event.stopPropagation()">
            
            <div class="p-4 flex justify-between items-center border-b border-slate-100 dark:border-slate-800">
                <h2 class="text-sm sm:text-lg font-bold truncate pl-4 dark:text-white" id="modalTitle">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h2>
                <button onclick="closeVideoModal()" class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 flex items-center justify-center transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            
            <div class="relative w-full pb-[56.25%] bg-black">
                <div id="videoContainer" class="absolute inset-0"></div>
            </div>
            
            <div class="p-3 bg-slate-50 dark:bg-slate-950 text-center">
                <p class="text-[10px] text-slate-400">Ù†ØµÙŠØ­Ø©: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù„Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø©</p>
            </div>
        </div>
    </div>

    <script>
        // ================= Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =================
        const PASSWORD = "123";
        let allData = [];
        let completedLectures = JSON.parse(localStorage.getItem('hameed_completed')) || [];
        let searchQuery = "";

        // ================= Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„ÙƒØ±ÙˆØª (Pastel + Dark support) =================
        const cardColors = [
            "border-l-4 border-blue-500 bg-blue-50/50 dark:bg-blue-900/10",
            "border-l-4 border-green-500 bg-green-50/50 dark:bg-green-900/10",
            "border-l-4 border-purple-500 bg-purple-50/50 dark:bg-purple-900/10",
            "border-l-4 border-orange-500 bg-orange-50/50 dark:bg-orange-900/10",
            "border-l-4 border-pink-500 bg-pink-50/50 dark:bg-pink-900/10",
            "border-l-4 border-cyan-500 bg-cyan-50/50 dark:bg-cyan-900/10",
        ];

        // ================= Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ =================
        document.addEventListener('DOMContentLoaded', () => {
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙˆØ¶Ø¹ Ø§Ù„Ø¸Ù„Ø§Ù…
            if (localStorage.getItem('hameed_darkMode') === 'true' || (!('hameed_darkMode' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }

            if (localStorage.getItem('hameedApp_isLoggedIn') === 'true') {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('appScreen').classList.remove('hidden');
                loadData();
            }
        });

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('hameed_darkMode', document.documentElement.classList.contains('dark'));
        }

        // ================= ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ =================
        function checkLogin() {
            const input = document.getElementById('passwordInput');
            if (input.value === PASSWORD) {
                localStorage.setItem('hameedApp_isLoggedIn', 'true');
                const screen = document.getElementById('loginScreen');
                screen.classList.add('opacity-0', 'scale-110');
                setTimeout(() => {
                    screen.classList.add('hidden');
                    document.getElementById('appScreen').classList.remove('hidden');
                    loadData();
                    showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸš€', 'success');
                }, 500);
            } else {
                showToast('Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø®Ø·Ø£! âŒ', 'error');
                input.value = '';
                input.focus();
            }
        }

        function logout() {
            if(confirm('Ù…ØªØ£ÙƒØ¯ ØªØ±ÙŠØ¯ ØªØ·Ù„Ø¹ØŸ')) {
                localStorage.removeItem('hameedApp_isLoggedIn');
                location.reload();
            }
        }

        // ================= Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ =================
        async function loadData() {
            // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„ÙˆØ§Ù‚Ø¹ÙŠØ©
            setTimeout(() => {
                const rawData = {
                    "teachers": [
                        {
                            "id": 3, "name": "Ø£. Ø­ÙŠØ¯Ø± ÙˆÙ„ÙŠØ¯", "subject": "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 
                            "image": "https://zockto.b-cdn.net/IMG_%D9%A2%D9%A0%D9%A2%D9%A5%D9%A1%D9%A1%D9%A2%D9%A2_%D9%A2%D9%A3%D9%A1%D9%A1%D9%A4%D9%A0_231.jpg",
                            "classes": [
                                { "name": "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø«", "lectures": [
                                    { "id": 301, "title": "Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 1", "url": "https://iframe.mediadelivery.net/embed/519756/ed13dc36-4508-45be-a79c-ca55e2ca12a4" },
                                    { "id": 302, "title": "Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 2", "url": "https://iframe.mediadelivery.net/embed/519756/951bdcde-9443-445b-bbea-ee438fc8081d" },
                                    { "id": 303, "title": "Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 3 - Ø¬1", "url": "https://iframe.mediadelivery.net/embed/519756/6e1ce8f5-f2b9-445a-a661-62f0de7be94e" },
                                    { "id": 304, "title": "Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 3 - Ø¬2", "url": "https://iframe.mediadelivery.net/embed/519756/f117345a-1799-4372-be36-3db68730f9d9" },
                                    { "id": 305, "title": "Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 4 - Ø¬1", "url": "https://iframe.mediadelivery.net/embed/519756/1937693d-ad81-4e27-afb7-8843b1051815" },
                                    { "id": 306, "title": "Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 4 - Ø¬2", "url": "https://iframe.mediadelivery.net/embed/519756/1937693d-ad81-4e27-afb7-8843b1051815" },
                                    { "id": 307, "title": "Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 5", "url": "https://iframe.mediadelivery.net/embed/519756/5ad74f20-c066-4874-882a-a5615ee52274" },
                                    { "id": 308, "title": "Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 6 (Ù‚Ø±ÙŠØ¨Ø§Ù‹)", "url": "#" },
                                    { "id": 309, "title": "Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 7 (Ù‚Ø±ÙŠØ¨Ø§Ù‹)", "url": "#" }
                                ]}
                            ]
                        }
                    ]
                };

                // ØªØ³Ø·ÙŠØ­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
                allData = rawData.teachers.map(teacher => {
                    let flatLectures = [];
                    teacher.classes.forEach(cls => {
                        cls.lectures.forEach(l => {
                            flatLectures.push({ ...l, fullTitle: `${cls.name}: ${l.title}`, teacherName: teacher.name });
                        });
                    });
                    return { ...teacher, lectures: flatLectures };
                });

                document.getElementById('loader').remove();
                renderApp();
                updateGreeting();
                updateStats();
                checkLastWatched();
            }, 800);
        }

        // ================= Ø§Ù„Ø±Ø³Ù… ÙˆØ§Ù„Ø¹Ø±Ø¶ (Rendering) =================
        function renderApp() {
            const container = document.getElementById('teachersContainer');
            // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø«Ø§Ø¨ØªØ© (Ø²Ø± Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙˆØ§Ù„Ø¯Ø§ÙØ¹)
            const resumeBtn = document.getElementById('resumeContainer');
            const motivation = container.querySelector('.bg-amber-50'); // ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†ØµØ± Ø§Ù„Ø¯Ø§ÙØ¹
            
            container.innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            if(resumeBtn) container.appendChild(resumeBtn);
            if(motivation) container.appendChild(motivation);

            let hasResults = false;

            allData.forEach(teacher => {
                // ØªØµÙÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
                const filteredLectures = teacher.lectures.filter(l => 
                    l.fullTitle.toLowerCase().includes(searchQuery.toLowerCase())
                );

                if (filteredLectures.length > 0) {
                    hasResults = true;
                    const card = document.createElement('div');
                    card.className = 'bg-white dark:bg-slate-800 rounded-3xl p-5 shadow-sm border border-slate-100 dark:border-slate-700 transition-all';
                    
                    let lecturesHtml = '';
                    filteredLectures.forEach((l, idx) => {
                        const isDone = completedLectures.includes(l.id);
                        const styleClass = cardColors[idx % cardColors.length];
                        
                        lecturesHtml += `
                            <div class="flex items-center justify-between p-3 rounded-xl mb-3 last:mb-0 transition-all hover:bg-slate-50 dark:hover:bg-slate-700/50 ${styleClass}">
                                <div class="flex items-center gap-3 flex-1 min-w-0 cursor-pointer" onclick="toggleComplete(${l.id})">
                                    <div class="checkbox-wrapper relative shrink-0 w-6 h-6">
                                        <input type="checkbox" class="sr-only" ${isDone ? 'checked' : ''}>
                                        <div class="w-6 h-6 border-2 border-slate-300 dark:border-slate-500 rounded-lg flex items-center justify-center transition-all bg-white dark:bg-slate-800">
                                            <svg class="w-3.5 h-3.5 text-white stroke-[3] transition-all stroke-dasharray-10 stroke-dashoffset-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                                        </div>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-bold text-sm sm:text-base dark:text-slate-200 transition-all ${isDone ? 'line-through text-slate-400 dark:text-slate-500' : ''}">${l.fullTitle}</span>
                                    </div>
                                </div>
                                <button onclick="openVideoModal('${l.fullTitle}', '${l.url}', ${l.id})" 
                                    class="${l.url === '#' ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-brand-50 text-brand-600 dark:bg-brand-900/30 dark:text-brand-300 hover:bg-brand-600 hover:text-white'} 
                                    w-10 h-10 rounded-xl flex items-center justify-center transition shadow-sm active:scale-95 shrink-0 ml-1">
                                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                </button>
                            </div>
                        `;
                    });

                    card.innerHTML = `
                        <div class="flex items-center gap-4 border-b border-slate-100 dark:border-slate-700 pb-4 mb-4">
                            <img src="${teacher.image}" class="w-16 h-16 rounded-2xl bg-slate-200 object-cover shadow-md ring-2 ring-white dark:ring-slate-600">
                            <div>
                                <h2 class="font-black text-lg text-slate-800 dark:text-white">${teacher.name}</h2>
                                <span class="text-xs font-bold text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded-md">${teacher.subject}</span>
                            </div>
                        </div>
                        <div class="space-y-1">${lecturesHtml}</div>
                    `;
                    container.appendChild(card);
                }
            });

            if (!hasResults) {
                container.innerHTML += `
                    <div class="text-center py-10 opacity-60">
                        <div class="text-4xl mb-2">ğŸ”</div>
                        <p class="text-slate-500 dark:text-slate-400 font-bold">Ù…Ø§ Ù„Ù‚ÙŠÙ†Ø§ Ø´ÙŠ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…!</p>
                    </div>`;
            }
        }

        // ================= Ø§Ù„Ø¨Ø­Ø« =================
        function filterLectures() {
            searchQuery = document.getElementById('searchInput').value;
            renderApp();
        }

        // ================= Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙØ§Ø¹Ù„ =================
        function toggleComplete(id) {
            if (completedLectures.includes(id)) {
                completedLectures = completedLectures.filter(i => i !== id);
            } else {
                completedLectures.push(id);
                triggerConfetti();
                showToast('Ø¹Ø§Ø´Øª Ø¥ÙŠØ¯Ùƒ ÙŠØ§ Ø¨Ø·Ù„! ğŸ’ª', 'success');
            }
            localStorage.setItem('hameed_completed', JSON.stringify(completedLectures));
            renderApp();
            updateStats();
        }

        function updateStats() {
            let total = 0;
            allData.forEach(t => total += t.lectures.length);
            const count = completedLectures.length;
            const percent = total === 0 ? 0 : Math.round((count / total) * 100);

            document.getElementById('percentage').innerText = percent + "%";
            document.getElementById('statsCount').innerText = count;
            document.getElementById('statsTotal').innerText = total;
            document.getElementById('progressBar').style.width = percent + "%";

            const badge = document.getElementById('statusBadge');
            if (percent === 100) { badge.innerText = "Ø®ØªÙ…Øª Ø§Ù„Ù…Ø§Ø¯Ø© ğŸ†"; badge.className = "bg-green-500 text-white px-3 py-1 rounded-lg text-xs font-bold mb-1 shadow-lg"; }
            else if (percent > 50) { badge.innerText = "ÙˆØ§ØµÙ„ Ø§Ù„ØªÙ‚Ø¯Ù… ğŸ”¥"; badge.className = "bg-orange-500 text-white px-3 py-1 rounded-lg text-xs font-bold mb-1 shadow-lg"; }
            else { badge.innerText = "Ø¨Ø¯Ø§ÙŠØ© Ù…ÙˆÙÙ‚Ø© ğŸš€"; badge.className = "bg-white/20 backdrop-blur-sm px-3 py-1 rounded-lg text-xs font-bold mb-1 border border-white/10"; }
        }

        // ================= Ø§Ù„ÙÙŠØ¯ÙŠÙˆ =================
        function openVideoModal(title, url, id, save = true) {
            if (url === '#') { showToast('Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹ ØªÙ†Ø²Ù„ØŒ Ø§Ù†ØªØ¸Ø±Ù†Ø§! â³', 'info'); return; }
            
            if (save) {
                localStorage.setItem('hameed_lastWatched', JSON.stringify({ title, url, id }));
                checkLastWatched();
            }

            const modal = document.getElementById('videoModal');
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('videoContainer').innerHTML = `<iframe src="${url}" class="absolute top-0 left-0 w-full h-full rounded-lg" allow="autoplay; fullscreen" allowfullscreen></iframe>`;
            
            modal.classList.remove('hidden');
            // Trigger animation
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.firstElementChild.classList.remove('scale-95');
                modal.firstElementChild.classList.add('scale-100');
            }, 10);
        }

        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            modal.classList.add('opacity-0');
            modal.firstElementChild.classList.remove('scale-100');
            modal.firstElementChild.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
                document.getElementById('videoContainer').innerHTML = '';
            }, 300);
        }

        function checkLastWatched() {
            const data = JSON.parse(localStorage.getItem('hameed_lastWatched'));
            const btn = document.getElementById('resumeContainer');
            if (data) {
                document.getElementById('resumeTitle').innerText = data.title;
                btn.classList.remove('hidden');
            }
        }

        function resumeLastWatched() {
            const data = JSON.parse(localStorage.getItem('hameed_lastWatched'));
            if (data) openVideoModal(data.title, data.url, data.id, false);
        }

        // ================= Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© (Helpers) =================
        function updateGreeting() {
            const h = new Date().getHours();
            const msg = h < 12 ? "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ± ÙŠØ§ Ø¨Ø·Ù„ â˜€ï¸" : "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ± ÙŠØ§ Ù…Ø¨Ø¯Ø¹ ğŸŒ™";
            document.getElementById('greetingMsg').innerText = msg;
            document.getElementById('dateDisplay').innerText = new Date().toLocaleDateString('ar-IQ', { weekday: 'long', day: 'numeric', month: 'short' });
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const colors = type === 'success' ? 'bg-emerald-500' : (type === 'error' ? 'bg-rose-500' : 'bg-blue-500');
            
            toast.className = `${colors} text-white px-6 py-3 rounded-2xl shadow-xl flex items-center gap-3 transform translate-y-10 opacity-0 transition-all duration-500 pointer-events-auto min-w-[200px] justify-center font-bold text-sm`;
            toast.innerHTML = `<span>${message}</span>`;
            
            container.appendChild(toast);
            
            requestAnimationFrame(() => {
                toast.classList.remove('translate-y-10', 'opacity-0');
            });

            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        // Confetti Effect (Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ù„)
        function triggerConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            for(let i=0; i<60; i++) {
                particles.push({
                    x: canvas.width/2, y: canvas.height/2,
                    vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15 - 5,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`,
                    life: 100, size: Math.random()*5+2
                });
            }
            
            function animate() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                let active = false;
                particles.forEach(p => {
                    if(p.life > 0) {
                        active = true;
                        p.x += p.vx; p.y += p.vy; p.vy += 0.3; p.life--; p.size *= 0.96;
                        ctx.fillStyle = p.color;
                        ctx.fillRect(p.x, p.y, p.size, p.size);
                    }
                });
                if(active) requestAnimationFrame(animate);
                else ctx.clearRect(0,0,canvas.width,canvas.height);
            }
            animate();
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
        document.getElementById('passwordInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkLogin() });
    </script>
</body>
</html>
